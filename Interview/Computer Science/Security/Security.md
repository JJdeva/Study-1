# 1. 대칭키 & 공개키

## A. 대칭키 (Symmetric Key)

### a. 정의

> 암호화와 복호화에 같은 암호키(대칭키)를 사용하는 알고리즘

동일한 키를 주고받기 때문에, 매우 빠르다는 장점이 있음

But, 대칭키 전달과정에서 해킹 위험에 노출

### b. 종류

- DES
- AES

## B. 공개키 (Public Key)

### a. 정의

> 암호화와 복호와에 사용하는 암호키를 분리한 알고리즘

자신이 가지고 있는 고유한 암호키(비밀키)로만 복호화할 수 있는 암호키(공개키)를 대중에 공개함

### b. 공개키 암호화 방식 진행 과정

1. A가 웹 상에 공개된 **B의 공개키**를 이용해 평문을 암호화하여 B에게 보냄
2. B는 자신의 비밀키로 복호화한 평문을 확인, A의 공개키로 응답을 암호화하여 A에게 보냄
3. A는 자신의 비밀키로 암호화된 응답문을 복호화함

대칭키의 단점을 완벽하게 해결했지만, 암호화 복호화가 매우 복잡함

(암호화하는 키와 복호화하는 키가 서로 다르기 때문)

### c. 종류

- RSA
- Elgamal
- Diffie Hellman
- ECC

## C. 대칭키와 공개키 암호화 방식을 적절히 혼합하면?

> SSL 탄생의 시초가 됨

1. A가 B의 공개키로 암호화 통신에 사용할 대칭키를 B의 공개키로 암호화하고 B에게 보냄
2. B는 암호문을 받고, 자신의 비밀키(개인키)로 복호화함
3. B는 A로부터 얻은 대칭키로 A에게 보낼 평문을 암호화하여 A에게 보냄
4. A는 자신의 대칭키로 암호문을 복호화함
5. 앞으로 이 대칭키로 암호화를 통신함

즉, 대칭키를 주고받을 때만 공개키 암호화 방식을 사용하고 이후에는 계속 대칭키 암호화 방식으로 통신하는 것

# 2. 시큐어 셸 (Secure Shell, SSH)

다른 컴퓨터와 통신을 할 때, 텔넷과 다르게 통신을 암호화하여 전송한다.

기본적으로 포트는 22번 포트를 사용한다.

공개키/개인키 알고리즘을 사용한다. (RSA)

# 3. SQL Injection

> 해커에 의해 조작된 SQL 쿼리문이 데이터베이스에 그대로 전달되어 비정상적인 명령을 실행시키는 공격 기법

## A. 공격 방법

### 1) 인증 우회

보통 로그인을 할 때, 아이디와 비밀번호를 input 창에 입력하게 된다. 쉽게 이해하기 위해 가벼운 예를 들어보자. 아이디가 abc, 비밀번호가 1234일 때 쿼리는 아래와 같이 전송된다.

```sql

SELECT * FROM USER WHERE ID = 'abc' AND PASSWORD = '1234';

```

SQL Injection으로 공격할 때, input 창에 비밀번호를 입력함과 동시에 다른 쿼리문을 함께 입력한다.

```sql

1234'; DELETE * USER FROM ID = '1';--

```

보안이 완벽하지 않은 경우, 이처럼 비밀번호가 아이디와 일치해서 True가 되고 뒤에 작성한 DELETE문도 데이터베이스에 영향을 줄 수도 있게 되는 치명적인 상황이다.

이 밖에도 기본 쿼리문의 WHERE절에 OR문을 추가하여 `'1' = '1'`과 같은 true문을 작성하여 무조건 적용되도록 수정한 뒤 DB를 마음대로 조작할 수도 있다.

### 2) 데이터 노출

시스템에서 발생하는 에러 메시지를 이용해 공격하는 방법이다. 보통 에러는 개발자가 버그를 수정하는 측면에서 도움을 받을 수 있는 존재다. 해커들은 이를 역이용해 악의적인 구문을 삽입하여 에러를 유발시킨다.

즉, 해커는 GET 방식으로 동작하는 URL 쿼리 스트링을 추가하여 에러를 발생시킨다. 이에 해당하는 오류가 발생하면, 이를 통해 해당 웹앱의 데이터베이스 구조를 유추할 수 있고 해킹에 활용한다.

## B. 방어 방법

### 1) input 값을 받을 때, 특수문자 여부 검사하기

로그인 전, 검증 로직을 추가하여 미리 설정한 특수문자들이 들어왔을 때 요청을 막아낸다.

### 2) SQL 서버 오류 발생 시, 해당하는 에러 메시지 감추기

view를 활용하여 원본 데이터베이스 테이블에는 접근 권한을 높인다. 일반 사용자는 view로만 접근하여 에러를 볼 수 없도록 만든다.

### 3) preparestatement 사용하기

preparestatement를 사용하면, 특수문자를 자동으로 escaping해준다. (statement와는 다르게 쿼리문에서 전달인자 값을 `?`로 받는 것)이를 활용해 서버 측에서 필터링 과정을 통해서 공격을 방어한다.