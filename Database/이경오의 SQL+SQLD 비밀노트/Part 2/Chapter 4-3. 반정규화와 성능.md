# 1. 반정규화의 정의

시스템의 성능 향상 및 개발(Development)과 유지보수(Maintenance)의 단순화를 위해 반정규화는 정규화된 데이터 모델을 분석하여 엔티티/속성/관계를 중복, 통합, 분리 등의 작업으로 수행하는 데이터 모델링 기법을 의미한다.

반정규화는 데이터를 고의적으로 중복 저장하여 조회 성능을 향상시키기 위한 기법이라고 정의할 수 있다. 데이터를 중복 저장함으로써 조인 연산이 회피되어 성능이 향상된다.

조회 성능을 향상시키기 위해 정규화된 데이터 모델에서 중복, 통합, 분리 등을 수행하는 모든 과정을 의미한다.

데이터 무결성이 깨질 수 있는 위험을 무릅쓰고 데이터를 중복하여 반정규화를 적용하는 상황은 데이터를 조회할 때 디스크 I/O량이 많아서 성능이 저하되는 경우, 테이블 간 경로가 너무 멀어 조인으로 인한 성능 저하가 예상되는 경우, 칼럼을 계산하여 읽을 때 성능이 저하될 것이 예상되는 경우이다.

아래 그림은 반정규화된 데이터 모델이 조회 성능을 향상시키는 방법을 표현하고 있다. 반정규화는 중복성의 원리를 활용하여 데이터 조회 시 성능을 향상시키는 역할을 한다.

![](/bin/db_image/SQLD_4_3_1.png)

# 2. 반정규화의 절차

하나의 난이도 높은 데이터 모델링의 실무기술이라고 할 수 있다. 반정규화가 필요하다고 판단되면 칼럼의 반정규화, 테이블의 반정규화, 관계의 반정규화를 종합적으로 고려하여 적용해야 한다.

![](/bin/db_image/SQLD_4_3_2.png)

반정규화 대상을 조사한 후, 무조건적인 반정규화가 아닌 다른 방법으로 유도할 수 있는지 검토해야 한다. 다른 방법을 모두 검토한 후에도 다른 해결책이 없다면 반정규화를 적용하여 성능을 향상시킨다.

# 3. 반정규화 기법

### A. 테이블 반정규화 기법

```ad-info
title: 테이블 반정규화 기법

- 테이블 병합
	- 1:1 관계 테이블 병합
		- 1:1 관계를 통합하여 성능을 향상시키는 방법
		- 2개의 테이블을 하나의 테이블로 병합하여 테이블 간 조인 연산을 제거한다.
	- 1:M 관계 테이블 병합
		- 1:M 관계를 통합하여 성능을 향상시키는 방법
		- 2개의 테이블을 하나의 테이블로 병합하여 테이블 간 조인 연산을 제거한다.
	- 슈퍼/서브 타입 테이블 병합
		- 슈퍼/서브 관계를 통합하여 성능을 항샹시키는 방법
		- 슈퍼/서브 타입 관계를 하나의 테이블로 병합하여 조인 연산을 제거한다.
- 테이블 분할
	- 수직 분할
		- 칼럼 단위의 테이블을 디스크 I/O 분산 처리하기 위해 테이블을 1:1로 분리하여 성능을 향상시키는 방법으로, 트랜잭션이 처리되는 유형 파악이 선행되어야 한다.
		- 예)
			- 게시글 테이블의 조회수 칼럼은 업데이트가 빈번하게 일어나므로 게시글의 조회수 저장용 테이블을 하나 더 만들어서 관리한다.
	- 수평 분할
		-  로우 단위로 집중 발생되는 트랜잭션을 분석하여 디스크 I/O 및 데이터 접근 효율을 높여 성능을 향상하기 위해 로우 단위로 테이블을 쪼개는 방법이다.
		- 예
			- 요금납부 테이블을 각 년월별 요금납부 테이블로 분할한다.
- 테이블 추가
	- 중복 테이블 추가
		- 다른 업무이거나 서버가 다른 경우 동일한 테이블 구조를 중복하여 원격 조인을 제거하여 성능을 향상시킨다.
	- 통계 테이블 추가
		- SUM, AVG 등을 미리 수행하여 계산해둠으로써 조회 시 성능을 향상시킨다.
	- 이력 테이블 추가
		- 이력 테이블 중에서 마스터 테이블에 존재하는 레코드를 중복하여 이력 테이블에 저장하는 반정규화 기법이다.
	- 부분 테이블 추가
		- 특정 테이블에서 전체 칼럼 중 자주 이용(조회)하는 집중화된 칼럼들이 있을 때, 디스크 I/O를 줄이기 위해 해당 칼럼들을 모아놓은 별도의 반정규화된 테이블을 생성한다.

```

테이블 병합은 여러 개의 테이블을 하나의 테이블로 합치는 것이다. 데이터의 중복 저장이 발생하지만 조회 성능 향상을 위해서(조인 연산의 불필요 등) 테이블 병합을 하는 것이다.

테이블 분할은 특정 테이블을 여러 개의 테이블로 쪼개는 것이다.

테이블 추가는 특정 테이블을 추가하여 데이터의 중복 저장이라는 비효율이 발생하는 것을 감안하더라도 조회 성능을 높이기 위한 방법이다.

### B. 칼럼 반정규화 기법

```ad-info
title: 칼럼의 반정규화 기법

- 중복 칼럼 추가
	- 조인 연산으로 인한 성능 저하를 예방하기 위해 중복 칼럼을 추가하여 조인 연산을 하지 않도록 한다.
	- 예)
		- 인사 테이블과 부서 테이블들을 조인하여 부서 테이블에 있는 부서명 칼럼을 조회할 때, 부서명 칼럼을 인사 테이블에도 중복으로 관리하여 부서 테이블을 조인하지 않고 인사 정보를 조회한다.
- 파생 칼럼 추가
	- 트랜잭션이 처리되는 시점에 계산에 의해 발생되는 값의 성능 저하를 예방하기 위해 미리 값을 계산하여 칼럼에 보관한다.
	- 예)
		- 총매출금액
- 이력 테이블 칼럼 추가
	- 대량의 이력 데이터를 처리할 때 불특정한 날 조회나 최근 값을 조회할 때 나타날 수 있는 성능 저하를 예방하기 위해 이력 테이블에 칼럼을 추가한다.
	- 예)
		- 최근값여부, 시작일자, 종료일자
- PK에 의한 칼럼 추가
	- 복합의미를 갖는 PK를 단일 속성으로 구성하였을 경우 단일PK 안에서 특정 값을 별도로 조회하는 경우 성능 저하가 발생할 수 있다.
	- 이때 이미 PK 안에 데이터가 존재하지만 성능 향상을 위해 일반 속성으로 생성하는 방법이 PK에 의한 칼럼 추가 반정규화이다.
	- 예)
		- 주문번호 값의 구성이 "상품코드 + 주문일자(YYYYMMDD) + 주문순번"으로 되어 있을 경우 주문번호 안에 존재하는 주문일자를 일반 속성으로 도출한 후 주문일자 칼럼을 인덱스로 생성한다.
- 응용 시스템의 오작동을 위한 칼럼 추가
	- 비즈니스적으로 의미가 없지만 사용자가 데이터 처리를 하다가 잘못 처리하여 원래의 값으로 복구를 원하는 경우 이전 데이터를 임시적으로 중복하여 보관하는 기법이다.
	- 칼럼으로 이것을 보관하는 방법은 오작동 처리를 위한 임시적인 기법이지만, 이것을 이력 데이터 모델로 풀어내면 정상적인 데이터 모델의 기법이 될 수 있다.

```

칼럼의 반정규화는 특정 칼럼을 추가하여 데이터 모델 내에서 중복으로 데이터가 저장되지만, 조회 성능을 향상시킬 수 있는 방안이다.

### C. 관계 반정규화 기법

```ad-info
title: 관계 반정규화 기법

- 중복 관계 추가
	- 데이터를 처리하기 위한 여러 경로를 거쳐 조인이 가능하지만, 이때 발생할 수 있는 성능 저하를 예방하기 위해 추가적인 관계를 맺는 방법이 관계의 반정규화이다.

```

여러 경로에 걸쳐서 조인하는 경우 조인 연산을 줄여주게 되어 조회 성능을 향상시키는 방법이다.

테이블과 칼럼의 반정규화는 데이터 무결성에 영향을 미치게 되나, 관계의 반정규화는 데이터 무결성을 깨뜨릴 위험을 갖지 않고서도 데이터 처리의 성능을 향상시킬 수 있는 반정규화 기법이다.