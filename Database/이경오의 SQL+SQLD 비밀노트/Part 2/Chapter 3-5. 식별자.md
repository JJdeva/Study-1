# 1. 식별자 개념

엔티티는 인스턴스들의 집합이다. 이러한 집합에서 단 하나의 인스턴스를 구별해 낼 수 있는 논리적인 이름이 필요하며 이러한 구분자를 식별자(Identifier)라고 한다.

엔티티의 각 인스턴스를 개별적으로 식별하기 위해 사용되는 하나의 속성 혹은 속성들의 조합을 식별자라고 한다. 엔티티 내에서 하나의 행을 콕 집어낼 때 사용한다.

# 2. 식별자의 특징

주식별자에 의해 엔티티 내의 모든 인스턴스들이 유일하게 구분되어야 하고, 주식별자를 구성하는 속성의 수는 유일성을 만족하는 최소의 수가 되어야 한다. 지정된 주 식별자의 값은 자주 변하지 않는 것이어야 하고, 주식별자가 지정되면 반드시 값을 포함해야 한다.

| 특징   | 내용                                                                                          | 예시                                                                                                                |
| ------ | --------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------- |
| 유일성 | 엔티티 내에 존재하는 각각의 인스턴스 집합은 주식별자에 의해 유일하게 구분할 수 있다.          | 사원번호 속성은 주식별자이다. 사원번호는 모든 직원들에 대해 개인별로 고유하게 부여된다.                             |
| 최소성 | 주식별자를 구성하는 속성의 수는 최소한의 수로 이루어져야 한다.                                | 사원번호만으로도 고유한 구조인데, 사원분류코드 + 사원번호 조합으로 식별자가 구성될 경우 부적절한 주식별자 구조이다. |
| 불변성 | 엔티티 내 특정 인스턴스에 주식별자가 한번 정해지면 그 값은 변하지 말아야 한다.                | 한번 정해진 사원번호의 값은 다른 값으로 변경되지 않아야 한다.                                                       |
| 조재성 | 주식별자로 정해진 속성은 반드시 데이터 값이 존재해야 한다. 주식별자는 NULL을 허용하지 않는다. | 사원번호가 없는 회사직원은 있을 수 없다.                                                                            |

# 3. 식별자의 분류
 
- 대표성 여부
	- 주식별자
		- 엔티티 내에서 각각의 행을 구분할 수 있는 구분자이다. 다른 엔티티와 참조관계를 가질 때 연결할 수 있는 식별자이다.
			- 사원번호, 고객번호
	- 보조식별자
		- 엔티티 내에서 각각의 행을 구분할 수 있다. 하지만 주식별자가 아니라서 대표성을 가지지 못하므로 다른 엔티티와 참조관계를 가질 때 연결할 수는 없다.
			- 주민등록번호
- 스스로 생성 여부
	- 내부식별자
		- 엔티티 내부에서 스스로 만들어지는 식별자이다.
			- 고객번호
	- 외부식별자
		- 다른 엔티티와의 관계를 통해 다른 엔티티로부터 받아오는 식별자이다.
			- 주문 엔티티의 고객번호
- 속성의 수
	- 단일 식별자
		- 하나의 속성으로 구성된 식별자
			- 고객 엔티티의 고객번호
	- 복합 식별자
		- 둘 이상의 속성으로 구성된 식별자
			- 주문 상세 엔티티의 주문번호 + 상세순번
- 대체 여부
	- 본질식별자
		- 비즈니스에 의해 만들어지는 식별자
			- 고객번호
	- 인조식별자
		- 본질식별자가 복잡한 구성을 가지고 있기 때문에 인위적으로 만든 식별자이다.
			- 주문 엔티티의 주문번호(원래는 고객번호+주문순번)

![](/bin/db_image/SQLD_3_5_1.png)

# 4. 식별자 도출 기준

```ad-info
title: 식별자 도출 기준

- 비즈니스에서 자주 이용되는 속성을 주식별자로 지정한다.
- 명칭, 장소와 같이 이름으로 기술되는 속성은 가능하면 주식별자로 하지 않는다.
- 주식별자를 복합식별자로 할 경우 지나치게 많은 속성이 포함되지 않도록 하낟.

```

![](/bin/db_image/SQLD_3_5_2.png)

직원 엔티티의 주민등록번호 속성도 식별자 후보가 될 수 있지만, 해당 업무에서 자주 사용하는 직원번호를 주식별자로 지정한다.

직원명과 같은 이름은 주식별자로 지정하지 않는다.

직원번호 + 주민등록번호 조합으로 복합식별자로 지정하면 유일성을 보장하지만, 최소성을 보장하지 않는다. 최소성 보장을 위해 직원번호만으로도 충분하기 때문에 직원번호로만 지정한다.

![](/bin/db_image/SQLD_3_5_3.png)

```ad-info
title: SQL

SELECT 계약금
FROM 접수
WHERE 접수.접수일자 = '20100715'
	AND 접수.관할부서 = '1001'
	AND 접수.입력자사번 = 'AB45688'
	...
;

```

단 1건의 데이터를 얻기 위해서 조건절(WHERE절)의 조건 수가 7개이다. 이러한 경우 아래 그림의 ERD와 같이 인조식별자인 접수번호 속성을 주가한다.

![](/bin/db_image/SQLD_3_5_4.png)

```ad-info
title: SQL

SELECT 계약금
FROM 접수
WHERE 접수.접수번호 = '1002040105601025'
;

```

인조식별자의 사용은 데이터 모델을 간편하고 알아보기 쉽게 하며 SQL문 작성에서도 간단 명료한 SQL문이 되게 한다.  
이러한 이유로 식별자 설계 시 과도한 복합식별자는 지양해야 한다.

# 5. 식별자 관계와 비식별자 관계의 결정

외부식별자는 다른 엔티티와의 관계를 통해 자식쪽 엔티티에 생성되는 속성을 말하며, 외래키(Foreign Key)역할을 한다.

식별자 관계를 사용할지 비식별자 관계를 사용할지는 업무 특징, 자식 엔티티의 주식별자 구성, SQL 작성 전략에 의해 결정된다.

### A. 식별자 관계

![](/bin/db_image/SQLD_3_5_5.png)

부모 엔티티의 식별자인 부모번호 속성을 자식 엔티티가 식별자로 사용하고 있다.

자식 입장에서 외부식별자(FK)를 자신의 식별자로 사용하고 있는 것을 식별자 관계라고 한다.  
자식 엔티티의 주식별자로 부모 엔티티의 주식별자가 상속이 되는 경우를 식별자 관계(Identifying Relationship)라고 지칭한다.

부모로부터 받은 식별자를 자식 엔티티의 주식별자로 이용하는 경우는 NULL이 허용되지 않으므로, 반드시 부모 엔티티가 생성되어야 자식 엔티티가 생성되는 경우이다.

식별자 관계는 자식 엔티티에서 외부식별자가 주식별자 역할을 한다.  
부모 엔티티의 식별자가 자식 엔티티에서도 식별자 역할을 하는 것이다.

### B. 비식별자 관계

![](/bin/db_image/SQLD_3_5_6.png)

부모 엔티티의 식별자인 부모번호 속성이 자식 엔티티의 식별자로 사용되지 않고 있다.  
자식 엔티티의 식별자는 자식번호이고 부모번호 속성은 외부식별자(FK)로만 존재한다.

자식 엔티티 입장에서 외부식별자(FK)를 자신의 식별자로 사용하고 있지 않은 것은 비식별자 관계라고 한다.  
부모 엔티티로부터 속성을 물려 받았지만 자식 엔티티의 주식별자로 사용하지 않고 일반적인 속성으로만 사용하는 경우이다.

```ad-info
title: 비식별자 관계를 갖는 경우

- 자식 엔티티에서 받은 속성이 반드시 필수가 아니어도 무방하기 때문에 부모 없는 자식이 생성될 수 있는 경우가 비식별자 관계이다.
- 자식 엔티티에서 별도의 주식별자를 생성하는 것이 더 유리하다고 판단될 때, 비식별자 관계에 의한 외부식별자로 표현한다.

```

![](/bin/db_image/SQLD_3_5_7.png)

# 6. 식별자 관계로만 설정할 경우의 문제점

![](/bin/db_image/SQLD_3_5_8.png)

관계가 도출될 때마다 PK 속성의 수가 지속적으로 증가하게 된다. SQL문 개발 시 필연적으로 테이블 간의 조인을 하게 되며, 조인에 참여하는 식별자 속성의 개수가 많을 경우 SQL문의 복잡도가 올라가면서 간혹가다 조인 조건을 누락하는 실수가 발견되기도 한다.

식별자 관계로만 관계를 맺을 경우에 SQL문의 복잡성이 올라가고, 조인 조건이 누락되는 실수가 발생할 확률이 높아진다.

![](/bin/db_image/SQLD_3_5_9.png)

주문 엔티티 구성 시 주문번호를 식별자로 지정하고, 고객번호를 외부식별자로 하는 비식별자 관계를 설정하므로써 SQL 작성 시 복잡성과 오류 가능성을 줄여주게 된다.

# 7. 식별자 관계 VS 비식별자 관계

데이터 모델링 작업 시 식별자 관계와 비식별자 관계를 취사 선택하여 연결하는 것은 높은 수준의 내공을 필요로 하는 데이터 모델링 기술이다.

식별자 관계에서 비식별자 관계를 파악하는 기술이 필요한데 아래 고려사항에 따라 비식별자 관계를 사용한다면 합리적으로 관계를 설정할 수 있다.

기본적으로 식별자 관계로 모든 관계를 연결하면서 아래 조건에 해당할 경우 비식별자 관계로 조정하면 된다.

![](/bin/db_image/SQLD_3_5_10.pn)]

관계의 강/약을 분석해서 약한 관계이거나 독립 PK 구성이 필요하거나 SQL의 복잡성을 증가시킬 수 있는 경우 비식별자 관계를 고려해야 한다.

![](/bin/db_image/SQLD_3_5_11.pn)]